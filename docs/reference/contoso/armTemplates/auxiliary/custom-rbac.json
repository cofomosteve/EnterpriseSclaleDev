{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {



        "globalvariable": {
            "type": "object",
            "defaultValue": {
                "scope": "",
                "scopeplatform": "",
                "scopemanagement": "",
                "scopeconnectivity": "",
                "scopeidentity": "",
                "scopelz": "",
                "scopelzonline": "",
                "scopelzcorp": "",

                "genericresourceprefix": {
                    "mgngroupmgn": "",
                    "resourcgroupmgn": "",
                    "policydefpmgn": "",
                    "policyassignmgn": "",
                    "rbacassignmgn": "",
                    "rbacdefmgn": "",
                    "loganalyticwkmgn": "",
                    "keyvaultmgn": "",
                    "storagemgn": "",
                    "storagediagnosticmgn": "",
                    "conatainerinstancemgn": "",
                    "containerregistrymgn": "",
                    "budgetconsumptionmgn": "",
                    "diasgsettingmgn": "",
                    "deploymentmgn": "",
                    "virtualnetworkmgn": "",
                    "subnetmgn": "",
                    "virtualnetworkpeeringmgn": "",
                    "virtualnetworkgatewaymgn": "",
                    "localnetworkgatewaylocalmgn": "",
                    "networksitetositemgn": "",
                    "vpnconnectionmgn": "",
                    "nsgmgn": "",
                    "asgmgn": "",
                    "pubipmgn": "",
                    "virtualmachinemgn": "",
                    "virtualmachinestorageaccountmgn": "",
                    "nicmgn": "",
                    "dnsprivatemgn": "",
                    "dnspubblicmgn": "",
                    "loadbalancermgn": "",
                    "applicationgatewaymgn": "",
                    "privatelinkmgn": "",
                    "privateendpointmgn": "",
                    "azurefirewallmgn": "",
                    "azurefirewallpoliciesmgn": "",
                    "azurefirewallrulegroupmgn": "",
                    "securityprincingmgn": "",
                    "workspacedatasourcemgn": "",
                    "automationaccountmgn": "",
                    "workspacemgn": "",
                    "linkedservicemgn": "",
                    "ddosplanmgn": "",
                    "networkwatchermgn": "",
                    "networkwatcherflowlogmgn": "",
                    "databaseauditsettingmgn": "",
                    "databasetransparencryptmgn": "",
                    "dataasesecalertpolmgn": "",
                    "databasevulassessmgn": "",
                    "virrtualhubmgn": "",
                    "virrtualhubconnectionmgn": "",
                    "virtualwanmgn": "",
                    "vpngatewaymgn": "",
                    "expressroutegatewaymgn": "",
                    "virtualmachineextensionmgn": "",
                    "opmanagesolutionmgn": "",
                    "azmonitorappinsigmgn": "",
                    "azmonitorvminsigmgn": "",
                    "azmonitornetworkinsigmgn": "",
                    "azmonitorsqlinsigmgn": "",
                    "azmonitorcontainerinsigmgn": "",
                    "azmonitorcosmosdbinsigmgn": "",
                    "azmonitorressourcegpinsigmgn": "",
                    "azmonitorstorageinsigmgn": "",
                    "azmonitorkeyvaultinsigmgn": "",
                    "azmonitorredisinsigmgn": "",
                    "trafficmanagemgn": "",
                    "cdnmgn": "",
                    "migratemgn": "",
                    "azureacrmgn": "",
                    "fontdoormgn": "",
                    "backupmgn": "",
                    "bastionhostmgn": ""
                }

            }
        }


    },
    "variables": {


        //********************************Variable for Generic Naming Convention*************************************/
        // "prefixmgn": "[parameters('globalvariable').prefixmgn]",
        // "appname": "[parameters('globalvariable').appname]",
        // "businessunit": "[parameters('globalvariable').businessunit]",
        // "topLevelManagementGroupPrefix": "[parameters('globalvariable').topLevelManagementGroupPrefix]",
        "scope": "[parameters('globalvariable').scope]",
        // "scopeplatform": "[parameters('globalvariable').scopeplatform]",
        // "scopemanagement": "[parameters('globalvariable').scopemanagement]",
        // "scopeconnectivity": "[parameters('globalvariable').scopeconnectivity]",
        // "scopeidentity": "[parameters('globalvariable').scopeidentity]",
        "scopelz": "[parameters('globalvariable').scopelz]",
        // "scopelzonline": "[parameters('globalvariable').scopelzonline]",
        // "scopelzcorp": "[parameters('globalvariable').scopelzcorp]",



        "systemopsrole": "[concat('','Custom Systems Ops')]",
        "landingzonewonerrole": "[concat('','Custom Landing Zone Owner')]",
        "landingzonecontributorrole": "[concat('','Custom Landing Zone Contributor')]",
        "kubernettesrole": "[concat('','Custom Kubernettes Administrator')]",
        "vmwarerole": "[concat('','Custom Vmware Solution Administrator')]",
        "billingrole": "[concat('','Custom  Billing Administrator')]",
        "secyrityopsrole": "[concat('','Custom Security Ops')]",
        "automationrole": "[concat('','Custom Automation')]",
        "computesrole": "[concat('','Custom Compute  Ops')]",
        "storagerole": "[concat('','Custom Storage  Ops')]",
        "databaseerole": "[concat('','Custom Database  Ops')]",
        "networksrole": "[concat('','Custom Network  Ops')]",
        "identityaccessmgnrole": "[concat('','Custom Identity and Access Management')]",
        "managementrole": "[concat('','Custom Management Administrator')]",
        "backuprole": "[concat('','Custom Backup et Recovery')]",
        "migrationRolerole": "[concat('','Custom Migration IaaS and PaaS')]",
        "devopsrole": "[concat('','Custom Devops')]",
        "apsopsrole": "[concat('','Custom AppsOps')]",
        "enablementrole": "[concat('','Custom Enablement')]",

        "systemopsroledesc": "Systems Ops",
        "kubernettesroledesc": "Kubernettes Administrator",
        "landingzonewonerroledesc": "Landing Zone Owner",
        "landingzonecontributorroledesc": "Landing Zone Contributor",
        "vmwareroledesc": "Vmware Solution Administrator",
        "billingroledesc": "Billing Administrator",
        "secyrityopsroledesc": "Security Ops",
        "automationroledesc": "Automation",
        "computesroledesc": "Compute  Ops",
        "storageroledesc": "Storage  Ops",
        "databaseeroledesc": "Database  Ops",
        "networksroledesc": "Network  Ops",
        "identityaccessmgnroledesc": "Identity and Access Management",
        "managementroledesc": "Management",
        "backuproledesc": "Backup et Recovery",
        "migrationRoleroledesc": "Migration IaaS and PaaS",
        "devopsroledesc": "Devops",
        "apsopsroledesc": "Appsops",
        "enablementroledesc": "Enablement",

        "systemopsroleid": "[guid(variables('systemopsrole'))]",
        "kubernettesroleid": "[guid(variables('kubernettesrole'))]",
        "landingzonewonerroleid": "[guid(variables('landingzonewonerrole'))]",
        "landingzonecontributorroleid": "[guid(variables('landingzonecontributorrole'))]",
        "vmwareroleid": "[guid(variables('vmwarerole'))]",
        "billingroleid": "[guid(variables('billingrole'))]",
        "secyrityopsroleid": "[guid(variables('secyrityopsrole'))]",
        "automationroleid": "[guid(variables('automationrole'))]",
        "computesroleid": "[guid(variables('computesrole'))]",
        "storageroleid": "[guid(variables('storagerole'))]",
        "databaseeroleid": "[guid(variables('databaseerole'))]",
        "networksroleid": "[guid(variables('networksrole'))]",
        "identityaccessmgnroleid": "[guid(variables('identityaccessmgnrole'))]",
        "managementroleid": "[guid(variables('managementrole'))]",
        "backuproleid": "[guid(variables('backuprole'))]",
        "migrationroleid": "[guid(variables('backuprole'))]",
        "devopsroleid": "[guid(variables('devopsrole'))]",
        "apsopsroleid": "[guid(variables('apsopsrole'))]",
        "enablementroleid": "[guid(variables('enablementrole'))]",

        "Role": {
            "RoleDefinitions": [
                {
                    "properties": {
                        "roleName": "[variables('systemopsrole')]",
                        "description": "[variables('systemopsroledesc')]",
                        "type": "customRole",
                        "id": "[variables('systemopsroleid')]",
                        "IsCustom": true,
                        "permissions": [
                            {
                                "actions": [

                                    "Microsoft.Insights/*",
                                    "Microsoft.Management/managementGroups/*",
                                    "Microsoft.Authorization/*",
                                    "Microsoft.Capacity/*",
                                    "Microsoft.RecoveryServices/*",
                                    //Monitoring
                                    "Microsoft.Insights/*",
                                    "Microsoft.AlertsManagement/*",
                                    "Microsoft.OperationalInsights/*",
                                    "Microsoft.WorkloadMonitor/monitors/*",

                                    "Microsoft.ContainerRegistry/*",

                                    "Microsoft.Resources/subscriptions/resourceGroups/read",
                                    "Microsoft.Management/managementGroups/read",

                                    //
                                    "Microsoft.Support/*"
                                ], //,
                                "notActions": [],
                                "dataActions": [],
                                "notDataActions": []
                            }
                        ],
                        "assignableScopes": [
                            "[variables('scope')]"
                        ]
                    },
                    "name": "[variables('systemopsrole')]"
                }
            ]
        }
    },

    "resources": [
        {
            //"condition": "[equals(parameters('enableCustomRBAC'), 'Yes')]",
            "type": "Microsoft.Authorization/roleDefinitions",
            "apiVersion": "2017-09-01",

            "copy": {
                "name": "RBACCustomDefinitionCopy",
                "count": "[length(variables('Role').RoleDefinitions)]"
            },
            "name": "[variables('Role').RoleDefinitions[copyIndex()].name]",
            "properties": {
                "roleName": "[variables('Role').RoleDefinitions[copyIndex()].properties.roleName]",
                "description": "[variables('Role').RoleDefinitions[copyIndex()].properties.description]",
                "type": "customRole",
                "id": "[variables('Role').RoleDefinitions[copyIndex()].properties.id]",
                "IsCustom": true,
                //"permissions": "[variables('Role').RoleDefinitions[copyIndex()].properties.permissions]",
                "permissions": [
                    {
                        "actions": "[variables('Role').RoleDefinitions[copyIndex()].properties.permissions.actions]",
                        "notActions": "[variables('Role').RoleDefinitions[copyIndex()].properties.permissions.notActions]",
                        "dataActions": "[variables('Role').RoleDefinitions[copyIndex()].properties.permissions.dataActions]",
                        "notDataActions": "[variables('Role').RoleDefinitions[copyIndex()].properties.permissions.notDataActions]"
                    }
                ],
                "assignableScopes": "[variables('Role').RoleDefinitions[copyIndex()].properties.assignableScopes]"
            }
        }
    ],

    "outputs": {}
}